<div class="flex min-h-screen bg-background-light">
  <!-- SideNavBar - Style Medflex -->
  <aside
    class="sidebar-medflex w-64 flex-shrink-0 border-r border-white/10 flex flex-col h-screen sticky top-0 shadow-xl z-[1001]"
    [class.mobile-open]="isMobileMenuOpen">
    <!-- Logo Section -->
    <div class="logo-container flex items-center justify-between px-6 py-4 bg-[#1c74bc]/10 border-b border-white/10">
      <div class="flex items-center gap-3">
        <div class="logo-bg flex items-center justify-center w-8 h-8 bg-white/20 rounded-lg">
          <img src="white.png" alt="Med-Connect" class="w-6 h-6 object-contain" />
        </div>
        <h1 class="text-white text-lg font-bold">MedConnect</h1>
      </div>

      <!-- Mobile Close Button -->
      <button class="md:hidden text-white/70 hover:bg-white/10 p-1 rounded-lg transition-colors"
        (click)="closeMobileMenu()">
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>

    <!-- Navigation Menu -->
    <nav class="flex-1 px-4 py-6 overflow-y-auto custom-scrollbar">
      <div class="space-y-2">
        <!-- Dashboard -->
        <a routerLink="dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}"
          class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-white/70 hover:text-white transition-all duration-200 group"
          (click)="closeMobileMenu()">
          <span class="material-symbols-outlined text-xl">dashboard</span>
          <span class="font-medium">Tableau de bord</span>
        </a>

        <!-- Utilisateurs -->
        <a routerLink="users" routerLinkActive="active"
          class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-white/70 hover:text-white transition-all duration-200 group"
          (click)="closeMobileMenu()">
          <span class="material-symbols-outlined text-xl">group</span>
          <span class="font-medium">Utilisateurs</span>
        </a>

        <!-- Vérifications -->
        <a routerLink="verifications" routerLinkActive="active"
          class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-white/70 hover:text-white transition-all duration-200 group"
          (click)="closeMobileMenu()">
          <span class="material-symbols-outlined text-xl">verified_user</span>
          <span class="font-medium">Vérifications</span>
        </a>

        <!-- Rapports -->
        <a routerLink="reports" routerLinkActive="active"
          class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-white/70 hover:text-white transition-all duration-200 group"
          (click)="closeMobileMenu()">
          <span class="material-symbols-outlined text-xl">summarize</span>
          <span class="font-medium">Rapports</span>
        </a>

        <!-- Mon Profil -->
        <!-- <a routerLink="profil" routerLinkActive="active"
          class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg text-white/70 hover:text-white transition-all duration-200 group"
          (click)="closeMobileMenu()">
          <span class="material-symbols-outlined text-xl">account_circle</span>
          <span class="font-medium">Mon Profil</span>
        </a> -->
      </div>
    </nav>

    <!-- Sidebar Footer - Logout -->
    <div class="p-4 border-t border-white/10">
      <button (click)="openLogoutDialog()"
        class="flex items-center gap-3 w-full px-4 py-3 rounded-lg text-white/70 hover:text-white hover:bg-white/10 transition-all duration-200 group font-medium">
        <span class="material-symbols-outlined text-xl text-red-400 group-hover:text-red-300">logout</span>
        <span>Déconnexion</span>
      </button>
    </div>
  </aside>

  <!-- Overlay for Mobile Sidebar -->
  <div *ngIf="isMobileMenuOpen" (click)="closeMobileMenu()"
    class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-[1000] md:hidden animate-fadeIn">
  </div>

  <!-- Main Content Area -->
  <main class="flex-1 flex flex-col h-screen overflow-hidden">
    <!-- TopNavBar - Style Medflex -->
    <header class="navbar-medflex bg-white text-slate-600 shadow-sm z-10 flex-shrink-0 border-b border-slate-100">
      <div class="flex items-center justify-between px-6 py-4">
        <!-- Left Section - Mobile Menu Button -->
        <div class="flex items-center gap-4">
          <button class="md:hidden p-2 rounded-lg hover:bg-slate-100 transition-colors text-slate-500"
            (click)="toggleMobileMenu()">
            <span class="material-symbols-outlined">menu</span>
          </button>

          <div class="hidden md:flex items-center max-w-md">
            <div class="relative group">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <span
                  class="material-symbols-outlined text-slate-400 group-focus-within:text-primary transition-colors">search</span>
              </div>
              <input type="text" placeholder="Rechercher..."
                class="search-input w-72 pl-10 pr-12 py-2 bg-slate-50 border border-slate-200 rounded-lg text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary/30 transition-all">
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <kbd
                  class="hidden sm:inline-flex items-center px-1.5 py-0.5 border border-slate-200 rounded text-[10px] font-sans font-medium text-slate-400 ">
                  ⌘K
                </kbd>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Section - Notifications & User Info -->
        <div class="flex items-center gap-3">

          <!-- Notifications -->
          <div class="relative">
            <!-- <button (click)="toggleNotifications()" data-notification-trigger
              class="relative p-2.5 rounded-xl hover:bg-slate-50 text-slate-500 transition-all flex items-center justify-center">
              <span class="material-symbols-outlined">notifications</span>
              <div *ngIf="unreadCount > 0"
                class="notification-badge absolute top-1.5 right-1.5 w-4 h-4 bg-red-500 border-2 border-white rounded-full flex items-center justify-center">
                <span class="text-white text-[9px] font-bold">{{ unreadCount > 9 ? '9+' : unreadCount }}</span>
              </div>
            </button> -->

            <!-- Notifications Dropdown Panel -->
            <div *ngIf="showNotifications"
              class="notification-dropdown absolute right-0 top-12 w-80 bg-white rounded-xl border border-gray-200 shadow-lg z-50 text-dark-gray">
              <div class="p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                  <h3 class="text-lg font-bold">Notifications</h3>
                  <span class="text-sm text-gray-500">{{ unreadCount }} non lues</span>
                </div>
              </div>

              <div class="max-h-96 overflow-y-auto">
                <div *ngFor="let notification of notifications" (click)="markAsRead(notification)"
                  class="p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors"
                  [class.bg-primary/5]="!notification.read">
                  <div class="flex items-start gap-3">
                    <div
                      class="flex items-center justify-center w-8 h-8 rounded-full bg-primary/10 text-primary flex-shrink-0">
                      <span class="material-symbols-outlined text-sm">{{ getNotificationIcon(notification.type)
                        }}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                      <p class="font-semibold text-sm">{{ notification.title }}</p>
                      <p class="text-gray-600 text-xs mt-1">{{ notification.message }}</p>
                      <p class="text-gray-400 text-xs mt-2">{{ getRelativeTime(notification.time) }}</p>
                    </div>
                    <div *ngIf="!notification.read" class="w-2 h-2 bg-primary rounded-full flex-shrink-0 mt-2"></div>
                  </div>
                </div>
              </div>

              <div class="p-4 border-t border-gray-200">
                <button class="w-full text-center text-primary hover:text-primary/80 text-sm font-medium">
                  Voir toutes les notifications
                </button>
              </div>
            </div>
          </div>
          <!-- User Profile -->
          <div class="flex items-center gap-3 pl-2 border-l border-slate-100" *ngIf="currentUser">
            <div class="hidden md:block text-right">
              <p class="text-sm font-bold text-slate-800 leading-tight">{{ currentUser.firstName }} {{
                currentUser.lastName }}</p>
              <p class="text-[11px] text-slate-400 font-medium">Administrateur</p>
            </div>
            <div class="relative w-10 h-10"> <!-- Outer relative, no overflow-hidden -->
              <div
                class="absolute inset-0 rounded-full border-2 border-white shadow-sm hover:scale-105 transition-transform cursor-pointer overflow-hidden bg-slate-50 flex items-center justify-center">
                <img
                  [src]="'https://api.dicebear.com/7.x/initials/svg?seed=' + (currentUser.firstName + ' ' + currentUser.lastName)"
                  [alt]="currentUser.firstName + ' ' + currentUser.lastName" class="w-full h-full object-cover" />
              </div>
              <div
                class="online-status absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 border border-white rounded-full z-10 shadow-md">
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content - Scrollable -->
    <div class="main-content flex-1 p-6 overflow-y-auto bg-background-light">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>